# Инструкции по публикации пакета pyrus-mcp

## Подготовка к публикации

### 1. Настройка npm токена

Для публикации пакета в npm необходимо настроить токен в GitHub Secrets:

1. Зайдите на [npmjs.com](https://www.npmjs.com) и войдите в свой аккаунт
2. Перейдите в Account Settings → Access Tokens
3. Создайте новый токен с правами "Automation" или "Publish"
4. Скопируйте токен

5. В GitHub репозитории перейдите в Settings → Secrets and variables → Actions
6. Добавьте новый secret с именем `NPM_TOKEN` и вставьте токен

### 2. Проверка package.json

Убедитесь, что в `package.json` указаны корректные данные:
- `name`: уникальное имя пакета в npm
- `version`: версия пакета (следует семантическому версионированию)
- `repository`, `bugs`, `homepage`: ссылки на GitHub репозиторий

### 3. Создание релиза

Для автоматической публикации можно:

**Вариант 1: Создать GitHub Release**
1. В GitHub репозитории перейдите в Releases
2. Нажмите "Create a new release"  
3. Создайте тег в формате `v1.0.0` (с префиксом v)
4. Заполните описание релиза
5. Опубликуйте релиз

**Вариант 2: Создать тег и запушить**
```bash
git tag v1.0.0
git push origin v1.0.0
```

**Вариант 3: Ручной запуск workflow**
1. Перейдите в Actions → Build and Publish to npm
2. Нажмите "Run workflow"
3. Выберите ветку и запустите

### 4. Обновление версии

Перед созданием нового релиза обновите версию:

```bash
npm version patch    # увеличивает 1.0.0 -> 1.0.1
npm version minor    # увеличивает 1.0.0 -> 1.1.0  
npm version major    # увеличивает 1.0.0 -> 2.0.0
```

Эта команда автоматически:
- Обновит версию в package.json
- Создаст git commit с изменением версии
- Создаст git tag с новой версией
- Запушит изменения и теги (благодаря postversion скрипту)

## Процесс публикации

GitHub Actions workflow автоматически:

1. **На создание релиза или тега v***:
   - Устанавливает зависимости
   - Собирает проект (`npm run build`)
   - Проверяет наличие артефактов сборки
   - Публикует в npm registry

2. **На push в main** (только сборка и тесты):
   - Проверяет сборку
   - НЕ публикует в npm

## Проверка публикации

После успешной публикации:

1. Проверьте пакет на npmjs.com: https://www.npmjs.com/package/pyrus-mcp
2. Установите пакет глобально для тестирования:
   ```bash
   npm install -g pyrus-mcp
   ```
3. Проверьте работу CLI:
   ```bash
   pyrus-mcp --help
   ```

## Устранение проблем

### Ошибка "package already exists"
- Увеличьте версию в package.json
- Или выберите другое уникальное имя пакета

### Ошибка авторизации
- Проверьте корректность NPM_TOKEN в GitHub Secrets
- Убедитесь, что токен имеет права на публикацию

### Ошибка сборки
- Проверьте, что проект собирается локально: `npm run build`
- Проверьте наличие всех зависимостей в package.json